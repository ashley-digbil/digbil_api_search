/**
 * Module dependencies.
 */
var crypto = require('crypto');

/**
 * Exports schema
 */
module.exports.load = function(mg) {
	var Schema = mg.Schema;
	var schema = new Schema({
		'ts' : {
			type : Date,
			'default' : Date.now
		},
		'ds' : {
			type : Schema.Types.ObjectId,
			ref : 'billboard'
		},
		'ds_hst' : [ {
			type : Schema.Types.ObjectId,
			ref : 'billboard'
		} ],
		'last_inst' : Date,
		'dsmodel' : {
			type : Schema.Types.ObjectId,
			ref : 'dsmodel'
		},
		'dsimage' : {
			type : Schema.Types.ObjectId,
			ref : 'dsimage'
		},
		'hardware' : {
			type : String,
			set : function(value) {
				var shasum = crypto.createHash('sha1');
				shasum.update(value);
				this.hash = shasum.digest('hex');
				return value;
			}
		},
		'hash' : {
			type : String,
			index : {
				unique : true
			}
		},
		"issuer" : {
			"service" : String, // fe-mcs
			"privip" : String,
			"pubip" : String,
			"host" : String
		}
	});
	return schema;
};
