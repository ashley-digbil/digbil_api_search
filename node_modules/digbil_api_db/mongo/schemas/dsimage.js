/**
 * @author Renaud Sauvain		
 */
/**
 * Module dependencies.
 */

/**
 * Exports schema
 */
module.exports.load = function(mg) {
	var Schema = mg.Schema;

	var ops = new Schema({
		'ts' : {
			type : Date,
			'default' : Date.now
		},
		'comment' : {
			type : String,
			trim : true
		},
		"optype" : {
			type : Number
		},
		"issuer" : {
			"service" : String, // fe-mcs
			"privip" : String,
			"pubip" : String,
			"host" : String,
			"user" : {
				type : Schema.Types.ObjectId,
				ref : 'userprofile'
			}
		}
	});

	/* ds image */
	var schema = new Schema({
		'ts' : {
			type : Date,
			'default' : Date.now
		},
		'cdate' : {
			type : Date,
			'default' : Date.now
		},
		"user" : {
			type : Schema.Types.ObjectId,
			ref : 'userprofile',
			index : true
		},
		"dsgroup" : {
			type : Schema.Types.ObjectId,
			ref : 'dsgroup'
		},
		'os' : String,
		'version' : String,
		'width' : String,
		'description' : String,
		'packages' : [ {
			'name' : String,
			'version' : String,
			'description' : String
		} ],

		'ops' : [ ops ],
		'stat' : {
			type : Number,
			'default' : 1
		},
		'auto_activate_ds' : {
			type : Boolean,
			'default' : false
		},
		'accepted_mac' : [ String ]
	});
	return schema;
};
