/**
 * @author Renaud Sauvain		
 */
/**
 * Module dependencies.
 */

/**
 * Exports schema
 */

var STATUS_MAP = {
	'N' : 0,
	'S' : 1,
	'P' : 2,
	'W' : 3,
	'C' : 4,
	'E' : 5,
	'D' : 6
};

module.exports.load = function(mg) {
	var Schema = mg.Schema;

	var schema = new Schema({
		'ts' : {
			type : Date,
			'default' : Date.now
		},
		'ds' : {
			type : Schema.Types.ObjectId,
			ref : 'billboard'
		},
		'rep_ts' : Date, // report timestamp
		'progress' : Number,
		'media' : {
			type : Schema.Types.ObjectId,
			ref : 'media'
		},
		'uri' : String,
		'trials' : Number,
		'stat' : {
			type : Number,
			'default' : 0
		}
	// 0 : Progress, 1 : Waiting(Pending), 2 : Cancelled, 3 : Done
	});
	schema.virtual('status').set(function(data) {
		if (typeof STATUS_MAP[data] == 'number')
			this.stat = STATUS_MAP[data];
		if (data == 'D')
			this.progress = 100;
	});
	return schema;
};
