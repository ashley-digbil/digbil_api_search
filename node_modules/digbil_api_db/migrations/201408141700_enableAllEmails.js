'use strict';

var Promise = require('bluebird');

// active all emails.
module.exports.run = function run(db, logger) {
    var User = db.get_collection('userprofile');

    return Promise.cast(User.find()
    .where('email.stat', 0).exec())
    .map(function(user) {
        user.email.forEach(function(email) { email.stat = 1; });
        user.markModified('email');
        return Promise.promisify(user.save, user)();
    })
    .all()
    .tap(function(users) {
        logger.debug('Activated emails for %d users', users.length);
    });

}
