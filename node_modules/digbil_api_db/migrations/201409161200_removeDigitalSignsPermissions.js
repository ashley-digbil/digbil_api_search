'use strict';
var Promise = require('bluebird');

// Remove the item DigitalSign in role's privileges
// and remove the corresponding permissions (rtype: 1)
module.exports.run = function run(db, logger) {
    var Permission = db.get_collection('permissions');
    var Role = db.get_collection('roles');

    var deletePrivileges = Promise.cast(Role.update({}, {
        $pull: {
            privileges: {function: 'DigitalSigns'}
        }
    }, {
        multi: true
    }).exec());

    var deletePermissions = Promise.cast(Permission.remove({
      rtype: 1 // DigitalSigns
    }).exec());

    return Promise.all([deletePrivileges, deletePermissions]);
}

