// This migration add the 'pending_media' field to all events.
//
// to run this:
// `nvm use 0.11 && node --harmony deckPermission.js` dev
// (replace dev with the desired environment)
'use strict';

let Promise = require('bluebird');
let mongoose = require('mongoose');
let ObjectId = mongoose.Types.ObjectId;
let _ = require('lodash');

let argv = require('minimist')(process.argv.slice(2));
let env = argv._[0] || 'test';
console.log('Migration on environment: '+ env);

Promise.coroutine(function* () {

    let db = yield require('./connect')(env);
    let Event = db.get_collection('event');

    yield Promise.cast(Event.update({}, {
        $set: {pending_media: false}
    }, {multi: true}).exec());
    console.log('done');

    process.exit(0);
})();
